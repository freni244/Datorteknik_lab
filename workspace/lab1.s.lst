68K GAS  ./lab1.s 			page 1


   1               	;$1000 start
   2               	;$4000-$4003 4 senaste hexa-tecknen
   3               	;$4010-$4013 korrekt kod
   4               	;$4020- textstrï¾ƒï½¤ngen'Felakig kod!'
   5               	;$7000 startvï¾ƒï½¤rde fï¾ƒ stackpekaren 
   6               	;set stackpointer->subrutin->...->move to monitor...rts
   7               	start:
   8 0000 2E7C 0000 		move.l #$7000,a7   	;sï¾ƒtackpekaren till a7 (a7 brukar vara tom)
   8      7000 
   9               	
  10 0006 4EBA 0024 		jsr printchar		;utskrift
  11 000a 4EBA 0038 		jsr setuppia		;drar igï¾ƒï½¥ng PIA A,B,C
  12 000e 4EBA 0064 		jsr printstring		;skriver ut en lista av tecken (ord)
  13 0012 4EBA 0076 		jsr deactivatealarm	;avaktivera larm
  14 0016 4EBA 0090 	        jsr activatealarm	;aktivera larm
  15 001a 4EBA 00AA 	        jsr getkey     		;keylistener
  16 001e 4EBA 00BA 	        jsr addkey     		;tangent->inbuffer
  17 0022 4EBA 00CE 		jsr clearinput		;rensa inbuffer
  18 0026 4EBA 00D4 		jsr checkcode  		;kodcheck
  19 002a 4E75      		rts
  20               		
  21               	printchar:		    ;utskrift i terminal
  22 002c 1F05      		move.b d5,-(a7)     ; Spara undan d5 (bit 7-0) pp stacken
  23               	waittx:	
  24 002e 1A39 0001 		move.b $10040,d5    ; Serieportens statusregister
  24      0040 
  25 0034 0205 0002 		and.b  #2,d5        ; Isolera bit 1 (Ready to transmit)
  26 0038 67F4      		beq waittx          ; Vï¾ƒï½¤nta tills serieporten ï¾ƒï½¤r klar att sï¾ƒï½¤nda
  27 003a 13C4 0001 		move.b d4,$10042    ; Skicka ut
  27      0042 
  28 0040 1A1F      		move.b (a7)+,d5     ; ï¾ƒï½¥terstï¾ƒï½¤ll d5
  29 0042 4E75      		rts 		    ; Tips: Sï¾ƒï½¤tt en breakpoint hï¾ƒï½¤r om du har problem med trace
  30               	
  31               	setuppia:	;initering
  32 0044 13FC 0000 		move.b #0,$10084    ; Vï¾ƒï½¤lj datariktningsregistret (DDRA)
  32      0001 0084 
  33 004c 13FC 0001 		move.b #1,$10080    ; Sï¾ƒï½¤tt pinne 0 pï¾ƒï½¥ PIAA som utgÃƒÂ¥ng
  33      0001 0080 
  34 0054 13FC 0004 		move.b #4,$10084    ; Vï¾ƒï½¤lj in/utgï¾ƒï½¥ngsregistret
  34      0001 0084 
  35 005c 13FC 0000 		move.b #0,$10086    ; Vï¾ƒï½¤lj datariktningsregistret (DDRB)
  35      0001 0086 
  36 0064 13FC 0000 		move.b #0,$10082    ; Sï¾ƒï½¤tt alla pinnar som ingï¾ƒï½¥ngar
  36      0001 0082 
  37 006c 13FC 0004 		move.b #4,$10086    ; Vï¾ƒï½¤lj in/utgï¾ƒï½¥ngsregistret
  37      0001 0086 
  38               	rts
  39               	
  40               	;;; ; ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  41               	;;;   Inargument: Pekare till strï¾‚ï½¨angen i a4
  42               	;;;   Lï¾‚ï½¨angd pï¾‹å•¾ strï¾‚ï½¨angen i d5
  43               	printstring:
  44               	;;;   Fï¾‚ï½¨orberedelseuppgift: Skriv denna subrutin!
  45               	;;;   vi kan loopa mha printchar och nï¾ƒï½¤rlï¾ƒï½¤ngden av d5 ï¾ƒï½¤r 0
  46               	;;;   vet vi att alla tecken blir utskrivna
  47 0074 287C 0000 		move.l #$C126,a4
  47      C126 
68K GAS  ./lab1.s 			page 2


  48 007a 7A16      		move.l #$16,d5
  49 007c 2827      		move.l -(a7),d4		;flyttar pekaren till a4
  50 007e 4EBA FFAC 		jsr printchar		;ï¾ƒï½¥teranvï¾ƒï½¤nd stack-funktionaliteten hï¾ƒï½¤r
  51 0082 5385      		sub.l #1,d5		;minskar lï¾ƒï½¤ngd d5 nmed 1 nu neftr printen
  52 0084 67EE      		beq rts			;ljï¾ƒï½¤mfï¾ƒï½¶r om branc ï¾ƒï½¤r 'equal'
  53 0086 60EC      		bra printstring		;hoppa direkt till bï¾ƒï½¶rjan
  54 0088 4E75      		rts			;gï¾ƒï½¥ till subrutinen som kallade pï¾ƒï½¥ printstring
  55               	;;; ; ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  56               	;;; ; ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  57               	;;;   Inargument: Inga
  58               	;;;   Utargument: Inga
  59               	;;;
  60               	;;;   Funktion: Slï¾‚ï½¨acker lysdioden kopplad till PIAA
  61               	
  62               	deactivatealarm:
  63               	;;;   Fï¾‚ï½¨orberedelseuppgift: Skriv denna subrutin!
  64               	;;;   hï¾ƒï½¤r kan man helt enkelt kolla pï¾ƒï½¥ fï¾ƒï½¶relï¾ƒï½¤sningsanteckningarna frï¾ƒï½¥n fï¾
  65               	;;;   move LED,D
  66               	;;;    or #$FD,D
  67               	;;;   move D,LED
  68 008a 33F9 0001 		move $10080,$10082
  68      0080 0001 
  68      0082 
  69 0094 0079 00FD 		or #$FD,$10082 		;slï¾ƒï½¤cker lampan
  69      0001 0082 
  70 009c 33F9 0001 		move $10082,$10080
  70      0082 0001 
  70      0080 
  71 00a6 4E75      		rts
  72               	;;; ; ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  73               	
  74               	;;; ; ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  75               	;;;   Inargument: Inga
  76               	;;;   Utargument: Inga
  77               	;;;
  78               	;;;   Funktion: Tï¾‚ï½¨ander lysdioden kopplad till PIAA
  79               	activatealarm:	
  80               	;;;   Fï¾‚ï½¨orberedelseuppgift: Skriv denna subrutn!
  81               	;;;   samma hï¾ƒï½¤r som de-.s lï¾ƒï½¤s fï¾ƒï½¶relï¾ƒï½¤snsanteckningar frï¾ƒï½¥n fï¾ƒï½¶ 04
  82 00a8 33F9 0001 		move $10080,$10082
  82      0080 0001 
  82      0082 
  83 00b2 0079 0001 	        or #$01,$10082	;tÃƒnd lampan
  83      0001 0082 
  84 00ba 33F9 0001 	        move $10082,$10080
  84      0082 0001 
  84      0080 
  85 00c4 4E75      	        rts
  86               	;;; ; ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  87               	
  88               	;;; ; ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  89               	;;;   Inargument: Inga
  90               	;;;   Utargument: Tryckt knappt returneras i d4
  91               	getkey:	
  92               	;;;   Fï¾‚ï½¨orberedelseuppgift: Skriv denna subrutin!
  93               	;;;   hï¾ƒï½¤r lï¾ƒï½¤ser vi av piab 0, piab 1, piab 2, piab 3 med abcd och a=MSB
  94               	;;;   kolla setuppia-rutinen fï¾ƒï½¶ ingï¾ƒï½¥ngar till hexa-tangentborde
68K GAS  ./lab1.s 			page 3


  95               	;;;   om hexa-tecknet ï¾ƒï½¤r mellan 0 och 9 skrivs en siffra utannars inte
  96 00c6 2A39 0001 		move.l $10082,d5 	;inmatning frï¾ƒï½¥n PIAB
  96      0082 
  97               	
  98 00cc 21C5 4010 		move.l d5,$4010		;inmatning av kod till minne
  99 00d0 21FC 0000 		move.l #$1234,$4000	;korrekt kod
  99      1234 4000 
 100               	
 101 00d8 4E75      		rts
 102               	;;; ; ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
 103               	
 104               	;;; ; ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
 105               	;;;   Inargument: Vald tangent i d4
 106               	;;;   Utargument: Inga
 107               	;;;
 108               	;;;   Funktion: Flyttar inneh???llet p??? $4001-$4003 bak???t en byte till
 109               	;;;   $4000-$4002. Lagrar sedan inneh???llet i d4 p??? adress $4003.
 110               	addkey:
 111               	;;;   F??orberedelseuppgift: Skriv denna subrutin
 112 00da 0C04 0009 		        cmp.b #9,d4 	;kollar om hexkey ??r st??rre ??n 9
 113 00de 6E10      		        bgt g_t_9	;om d4 sst?rre ?n??9->hoppa ut
 114 00e0 2838 4010 		        move.l $4010,d4 ;annars detta
 115 00e4 E18C      		        lsl.l #8,d4     ;forts??tter vidare i str??ngen
 116 00e6 21C4 4010 		        move.l d4,$4010 ;flyttar tillbaka d3 till 4 senaste hexa-tecknen
 117 00ea 21C4 4013 		        move.l d4,$4013 ;senaste siffran i PIAB
 118 00ee 4E75      		        rts
 119               	g_t_9:
 120 00f0 4E75      		        rts
 121               	;;; ; ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
 122               		
 123               	;;; ; ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
 124               	;;;   Inargument: Inga
 125               	;;;   Utargument: Inga
 126               	;;;
 127               	;;;   Funktion: SÃ‚Â¨atter innehÃ‹Âšallet pÃ‹Âša $4000-$4003 till $FF
 128               	clearinput:	
 129               	;;;   FÃ‚Â¨orberedelseuppgift: Skriv denna subrutin
 130               	;;;   HÃƒÂ¤r kan i fylla minnet med 20 bitar (minneskapaciteten i MC68008)
 131               	;;;   typ som setup i dugga1 fast istÃƒÂ¤Ã¯Â¿Â½llet med tomma vÃƒÂ¤rden
 132 00f2 21FC 000F 		move.l #$fffff,$4000
 132      FFFF 4000 
 133 00fa 4E75      		rts
 134               	;;; ; ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
 135               	
 136               	;;; ; ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
 137               	;;;   Inargument: Inga
 138               	;;;   Utargument: Returnerar 1 i d4 om koden var korrekt, annars 0 i d4
 139               	;;;   hÃƒÂ¤r kan vi antingen ÃƒÂ¤ndra vÃƒÂ¤rden internt i checkcode eller
 140               	;;;   hoppa till ytterligare subrutiner och ÃƒÂ¤ndra
 141               	checkcode:	
 142               	;;;   FÃ‚Â¨orberedelseuppgift: Skriv denna subrutin
 143 00fc 2438 4000 		move.l $4000,d2 	;vi kollar input
 144 0100 2638 4010 		move.l $4010,d3		;vi lÃƒÂ¤gger fram korrekt kod
 145 0104 B682      		cmp.l d2,d3		;vi jÃƒÂ¤mfÃƒÂ¶input med korrekt kod
 146 0106 6706      		beq correct		;om rkorrekt sÃƒÂ¤tts d4 till 1
 147 0108 183C 0000 		move.b #0,d4		;annars 0 i d4
 148 010c 4E75      		rts
68K GAS  ./lab1.s 			page 4


 149               	correct:
 150 010e 183C 0001 		move.b #1,d4		;checkcode hoppar hit om d2 och d3 ÃƒÂ¤r samma
 151 0112 4E75      		rts
 152               	;;; ; ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
